# Component: `TransactionHistory`

## 1. 개요

사용자의 모든 암호화폐 거래 내역을 시간순으로 보여주는 컴포넌트입니다.

## 2. 기능

-   **거래 내역 표시:** `PortfolioContext`로부터 받은 `transactions` 배열을 순회하며 표 형태로 렌더링합니다.
-   **상세 정보 제공:** 각 거래에 대해 시간, 종류(매수/매도), 종목, 수량, 체결 가격, 총 거래 금액을 표시합니다.
-   **AI 분석 기능:**
    -   각 거래 내역 옆에 '분석' 버튼이 있습니다.
    -   이 버튼을 클릭하면 `handleAnalyze` 함수가 실행되어 `/api/analyze-trade` 엔드포인트에 해당 거래 정보를 전송합니다.
    -   API로부터 분석 결과를 받아오기 전까지 버튼은 "분석중..." 상태로 비활성화됩니다.
    -   분석이 완료되면, 반환된 텍스트를 해당 거래의 'AI 분석' 열에 표시합니다.
-   거래 내역이 없을 경우 "거래 내역이 없습니다."라는 메시지를 보여줍니다.

## 3. 주요 상태(State) 및 Props

### Props

이 컴포넌트는 외부로부터 전달받는 `props`가 없습니다.

### 내부 상태

-   `analysis`: 각 거래 ID(`tx.id`)를 키로, AI 분석 결과를 값으로 저장하는 객체 (`{ [txId: string]: string }`)
-   `loadingAnalysis`: 현재 분석이 진행 중인 거래의 ID를 저장하는 문자열. 로딩 상태를 표시하는 데 사용됩니다.

### Context 사용

-   `usePortfolio` 컨텍스트 훅을 사용하여 다음을 가져옵니다.
    -   `transactions`: 모든 거래 내역 객체의 배열 (`Transaction[]`)
    -   `assets`: 현재 보유 자산 배열 (분석 시 현재가를 참조하기 위해 사용)

## 4. 데이터 흐름

1.  `usePortfolio` 컨텍스트에서 `transactions` 데이터를 가져와 표를 렌더링합니다.
2.  사용자가 특정 거래의 '분석' 버튼을 클릭하면 `handleAnalyze` 함수가 해당 거래(`tx`) 정보와 함께 호출됩니다.
3.  `loadingAnalysis` 상태를 해당 `tx.id`로 설정하여 로딩 UI를 활성화합니다.
4.  `/api/analyze-trade` 엔드포인트로 `POST` 요청을 보냅니다. 요청 본문에는 거래 정보와 현재 시장 가격(또는 평균 매수 단가)이 포함됩니다.
5.  API로부터 성공적으로 응답을 받으면, `analysis` 상태에 `tx.id`를 키로 하여 분석 결과를 저장합니다.
6.  `analysis` 상태가 업데이트되면, 컴포넌트가 리렌더링되어 분석 결과 텍스트가 화면에 표시됩니다.
7.  분석 요청이 실패하면 "분석에 실패했습니다." 메시지를 저장하고 표시합니다.
8.  분석 과정이 끝나면 `loadingAnalysis` 상태를 `null`로 되돌립니다.
