# 백그라운드 작업 시스템 도입을 통한 성능 개선 계획

## 문제점

현재 시스템은 사용자가 새로운 거래를 생성할 때, API 응답 시간 내에 너무 많은 작업을 동기적으로 처리하여 지연이 발생합니다.

- **거래 API (`/api/transactions`):** 거래 생성 요청 시, AI 분석, 수익률 계산, 텔레그램 알림 전송 등의 무거운 작업들이 서버에서 모두 처리된 후 응답이 완료됩니다. 이로 인해 사용자는 거래 버튼 클릭 후 수 초간의 지연을 경험하게 됩니다.
- **전략 실행:** 일부 전략(특히 뉴스 기반 전략)은 다수의 API를 순차적으로 호출하여 전체 시스템의 반응성을 저하시킵니다.

## 해결 방안: 백그라운드 작업(Job) 시스템 도입

사용자 요청에 대한 응답 시간을 최소화하기 위해, 시간이 오래 걸리는 작업들을 백그라운드에서 비동기적으로 처리하는 'Job Queue' 아키텍처를 도입합니다.

### 1단계: 거래 처리 로직 개선

**목표:** 거래 생성 API의 응답 시간을 1초 미만으로 단축합니다.

1.  **`jobs` 테이블 추가:** 데이터베이스에 새로운 `jobs` 테이블을 생성합니다. 이 테이블은 처리해야 할 작업의 종류, 관련 데이터, 상태(대기, 진행 중, 완료, 실패)를 저장합니다.

    -   `id`: 작업 고유 ID
    -   `type`: 작업 종류 (예: `analyze_transaction`)
    -   `payload`: 작업에 필요한 데이터 (예: `{ "transactionId": "..." }`)
    -   `status`: `pending`, `processing`, `completed`, `failed`
    -   `result`: 작업 결과 또는 에러 메시지
    -   `created_at`, `updated_at`

2.  **API 라우트 수정 (`/api/transactions`):**
    -   `POST` 요청을 받으면, `transactions` 테이블에 거래 내역만 저장합니다.
    -   그 후, `jobs` 테이블에 `type='analyze_transaction'` 인 새로운 작업을 추가합니다.
    -   즉시 클라이언트에 성공 응답을 보냅니다.

3.  **백그라운드 워커(Worker) 구현:**
    -   서버가 시작될 때, 주기적으로(예: 5초마다) `jobs` 테이블을 확인하는 워커 프로세스를 실행합니다.
    -   워커는 `status='pending'` 인 작업을 가져와 `status='processing'`으로 변경합니다.
    -   작업 종류에 따라 적절한 로직(AI 분석, 텔레그램 알림 등)을 실행합니다.
    -   작업이 끝나면 `status`를 `completed` 또는 `failed`로 업데이트하고 결과를 저장합니다.

### 2단계: 전략 실행 최적화

**목표:** 비효율적인 전략 실행 로직을 개선합니다.

1.  **병렬 처리:** '뉴스 기반 전략' 등에서 여러 API를 순차적으로 호출하는 부분을 `Promise.all` 등을 사용하여 병렬로 처리하도록 수정하여 전체 실행 시간을 단축합니다.

---

이 문서는 작업이 중단될 경우를 대비하여 계획을 기록하기 위해 작성되었습니다. 1단계부터 순차적으로 진행합니다.
